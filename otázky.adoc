Zkouškové otázky z předmětu Operační systémy
============================================
:toc: 
:imagesdir: ./pics/


== 1. Otázka ==
=== Co je operační systém. 
Operační systém jsou programové
moduly ve výpočetním systému, jež
ovládají řízení prostředků, kterými je
tento výpočetní systém vybaven, jako
jsou procesory, paměť (operační i
vnější), I/O zařízení a soubory dat.
Operační systém rozhoduje spory, snaží
se optimalizovat výkon a zjednodušují
efektivní využívání výpočetního
systému.

===  Úkoly operačního systému. 
* Správa a přidělování paměti – virtuální paměť
* Správa procesů – synchronizace
* Přidělování procesoru – multitasking
* Řešení zablokování – deadlock
* Správa systému souborů – virtuální souborový systém (VFS)
* Správa uživatelů

===  Zavedení operačního systému. 
* Z BIOSu (Basic Input Output System –
programovatelná paměť) nebo UEFI (Unified
Extensible Firmware Interface) se zjistí
médium, na kterém je OS
* Na tomto médiu se na MBR (Master Boot
Record) načte OS nebo zavaděč OS
* Příklad Linux:
** Zavaděč GRUB
** Jádro /boot/vmlinuz a RAM disk /boot/initrd
(nemusí být) se zavedou do paměti a
převezmou řízení počítače

=== Rozdělení operačních systémů. 
* Podle správy uživatelů
** Jednouživatelské (monouser)
** Víceuživatelské (multiuser)
*** Více uživatelů pracuje současně v reálném čase
*** Musí zajistit rozdělení a oddělení prostředků (paměti) mezi uživatele
* Podle počtu spuštěných programů
** Jednoprogramové (monotasking)
** Víceprogramové (multitasking) – více úloh je spuštěno současně
* Podle schopnosti práce v síti
** Lokální - nedokáží pracovat v síti bez přídavných modulů
** Síťové - mají klientskou i serverovou verzi
* Podle míry specializace
** Speciální - pro jeden typ úloh
** Univerzální - různé typy úloh

===  Vlastnosti operačních systémů. 
==== Multitasking
* Umožňuje souběžně pracovat ve více úlohách
* Lze spustit více programů najednou nemusí se neustále jednotlivé aplikace ukončovat a startovat
* Rozlišujeme:
** kooperativní m. - přidělují prováděným procesům procesor na takovou dobu, na jakou ji potřebují ostatní programy mohou zůstat bez odezvy
** preemptivní m. - vysoce výkonný, systém rozděluje, komu přidělí jakou dobu procesu mají stejnou dobu, lze nastavovat priority 

==== Souborový systém
* Algoritmus pro zapisování dat na disk
* FAT, FAT32, Ext, NTFS, BTRFS
* Některé systémy mohou číst i odlišné, ale na vždy a všechny 

==== Bootování
* Zavádění operačního systému
* Zavádí se z pevného disku, CD nebo Flash

==== Plug & play
* Umožňují automaticky detekovat nový hardware přidaný do počítače a také instalovat
* Pokud není, nutno ručně

==== Uživatelské rozhraní
* Prostředí, ve kterém se uživatel pohybuje 

===  Real time OS.
* Zvláštní kategorie
* Takové OS, které musí být schopny práce v reálném čase a reagovat okamžitě (reálně do určité časové hranice). Např. při řízení letadla nebo jaderné elektrárny, kde velké prodlevy jsou nemožné.
* Musí reagovat okamžitě — horní časová hranice
* Většinou mají malé jádro (mikrojádro), které ovládá jen základní funkce a na vše další se volají moduly
* Příklady:
** QNX
** RTLinux – rozšíření jádra Linuxu
** RTX — RealTime eXtension – nadstavba pro Windows

== 2. Otázka
=== UNIX – historie
* Druhá polovina šedesátých let
* Vyvinut ze systému Multics
* Původně vyvinut jako systém pro zpracování textů
* Autoři Ken Thompson a Denis Ritchie
* Název vymyslel Brian Kernighan
* Původně napsán v jazyce B, z kterého byl
* Vyvinut v r. 1971 jazyk C

=== Vlastnosti OS UNIX
* Multiprogramový
* Multiuživatelský
* Víceprocesorový
* S terminálovým přístupem
* Operační systém UNIX musí uživateli u terminálu vytvořit pocit, že počítač schovaný za terminálem je pouze" jeho.
* Jádro běží v privilegovaném režimu
* Obvykle je tvořeno jedním souborem – monolitický systém (v Linuxu /boot/vmlinuz)
* Vše ostatní běží v uživatelském režimu

=== Souborové systémy v UNIXu
* Systém souborů extended FS, (e2fs, e4fs) XFS (Linux), ufs (Solaris), HFS (OS X)
* UNIX (Linux) má jednotnou strukturu adresářů – měla by být jednotná na všech systémech
* Norma POSIX a POSIX-2
* Extended
** Verze Ext (již se nepoužívá), Ext2, Ext3 a Ext4
** Bloky mají velikost 512, 1024, 2048 nebo 4096 B.
** První blok je boot blok.
** Další bloky jsou rozděleny do skupin, každá obsahuje superblok s informacemi o celém disku - při poškození jednoho se použije jiny.
** Informace o souborech jsou v tzv. i-node (i-uzel).
** Volné místo se eviduje v řetězovém seznamu.
** Moznost použít odkazy (linky)
* XFS - Žurnálovací systém. 64 bitový - velikost souboru i souborového systému téměř neomezena. Jsou žurnálována metadata ale ne samotná data - rychlejší ale méně bezpečný než ext4.
* ZFS - Zettabyte File System. 128 bitový systém. Má v sobe přímo integrován manažer logických oddílů. Až 1 ZB dat (1 ZB = 1 bilion TB). Umí automaticky opravovat chyby.
* BTRFS - souborový systém podobny ZFS, založený na B stromech.
* APFS – Apple File System (Starší HFS+) – pro Macos

=== Prvky ochrany souborů a adresářů v UNIXu

Prvky ochrany se určují zvlášť pro:

* majitele souboru (u - user)
* skupinu uživatelů (g - group)
* ostatní, svět (o - other)
* všechny (a - all)

Přidělují se práva pro:

* soubor
** čtení (r)
** zápis (w)
** provedení (spuštění - x)
* adresář
** výpis obsahu (r)
** přejmenování (smazání) (w)
** vstup do adresáře (x)

=== Linux – historie 
Linux vytvořil student Linus Torvalds pomocí operačního systému Minix profesora Tannenbauma v roce 1991

* Tento svůj systém oznámil v mailové konferenci 25. srpna 1991 V té době studoval na univerzitě v Helsinkách informatiku ve druhém ročníku
* Používal PC 386 s 4 MB paměti

=== Vlastnosti OS Linux
* Operační systém Linux je volně šiřitelný OS typu UNIX. Jeho autorem je Linus Torvalds a mnoho dalších programátorů v Internetu. Jádro Linuxu je volně šiřitelné (public domain) podle pravidel GNU General Public License (licence používaná u softwaru GNU).
* Základem Linuxu je jádro, které je vlastně samotný Linux. K němu se potom nabalují další programy
* Množiny programů tvoří distribuce
* Existuje stovky distribucí 

=== Distribuce a jádro Linuxu
Balíky programů, dané dohromady nějakou firmou nebo skupinou lidí

* komerční – platí se buď přímo za média (obvykle lze stáhnout zdarma verzi z ftp) nebo za podporu a manuály
* nekomerční
* překládané – uživatel si stáhne zdrojové texty a distribuci si sám přeloží
* live – pracují přímo z CD, není nutný HD

Linux je možno instalovat z CD (DVD), USB disku nebo po síti (FTP, lokální síť)
* I v druhém případě potřebujeme instalační USB disk nebo CD ze kterého se zavede základní systém
* Je možná i síťová instalace s nabootováním přes síť, ale musí to zvládat síťová karta
* V případě překládané instalace se zavede základní systém a překladač z CD nebo USB disku, pak se z internetu stáhnou zdrojové kódy a celý systém se přeloží

Jádro Linuxu je založené na MINIXu

=== MacOS
* Vlastní operační systém
* Nebyl nikdy portován pro jiné platformy
* Verze 1 až 9
* Verze 1 až 8.1 pro M86k procesor
* Verze 7.2 až 9 pro PPC
* Od verze 8.0 pro G3 procesor
* Od 8.6 pro G4 procesor
* Verze 1 až 7.5.5 jsou volně šiřitelné
* Verze 7.6 a novější ne
* MacOS X

Vývoj:

* Systém 4.2 podpora 32 MB disků
* Systém 5 – v prodeji velmi krátce
* Systém 6 barvy
* Systém 7 - nazván jako první MacOS 7

MacOS 7:

* Multitasking
* Odpadkový koš
* Sdílení souborů, Apple Talk
* Aliasy (linky) – fungovaly i když byl cílový soubor překopírován
* Doplňky – extension
* Ovládací panely
* Apple menu
* AppleScript
* TrueType fonty
* Více disket, později na CD

iOS:

* Operační systém pro přenosná zařízení
* iPod touch, iPad, iPhone
* Původně chtěl Apple použít Android nebo upravený Linux
* iOS je úpravou a zjednodušením Mac OS X

== 3. Otázka
=== OS firmy Microsoft přehled, vlastnosti
==== MS DOS
** V roce 1980 pro firmu IBM pro počítač IBM PC 5150
** Koupen za 50 000 dolarů od firmy Seattle Computer Products jako QDOS (Quick and Dirty Operating System)
** Upraven pro IBM PC
** Vycházel z OS CP/M
** IBM PC 5150 – procesor 8086 4,77 Mhz, 64 kB RAM, černobílý monitor, disketová jednotka, klávesnice, stál cca. 4500 dolarů
** Vlastnosti:
*** Jednouživatelský
*** Jednoprogramový
*** Lokální
*** Vrstvená struktura
*** Verze 1.0 až 8.0
*** Poslední „čistá verze“ 6.22
*** 7.0 = Windows95
*** 7.1 = Windows98
*** 8.0 = Windows Me
** Vrstvy MS DOSu:
*** BIOS – základní ovládání HW pomocí softwarových a hardwarových přerušení, IO.SYS – obsluha periferií
*** jádro systému – soubor MSDOS.SYS – monolitické jádro
*** textové rozhraní mezi systémem a uživatelem – soubor COMMAND.COM (obsahuje některé příkazy = vnitřní příkazy). Ostatní příkazy (externí) jsou programy s koncovkou COM (do 64 kB) a EXE
*** Poslední vrstva obsahuje tyto vnější příkazy, dále uživatelské programy a dva konfigurační soubory
*** CONFIG.SYS – nastavení hardware – ovladače pro monitor, CD ROM, znaková sada
*** AUTOEXEC.BAT – nastavení software

==== Windows 1.0
** Tyto první Windows byly dodávány na pěti 5,25palcových 360kB disketách: Setup/Build, Utilities, Fonts, Desktop Applications a Program Disk.
** Nainstalované na disku zabraly méně jak 1 MB.
** Podporovaly několik ukazovacích zařízení, grafiku CGA, Hercules a EGA a také 19 tiskáren.
** Obsahovaly v základu správce souborů, kalkulačku, kalendář, kartotéku, hodiny, poznámkový blok, terminál, MS-DOS Executive, hru Reversi, Control Panel, PIF (Program Information File) Editor, Print Spooler, Clipboard, RAM Drive, Windows Write, Windows Paint.
** Microsoft Write měl podporu více písem a základním formátováním znaků a odstavců, zavedl také příponu  DOC.
** Zavedena klávesová zkratka Alt-F4 pro zavírání aplikací.

==== Windows 2.0
** 9. prosince 1987 – pro procesor 286
** Poprvé se objevuje DDE (dynamická výměna dat mezi aplikacemi).
** Poprvé se mohla jednotlivá okna aplikací přes sebe překrývat.

==== Windows 2.1
** 1987
** Windows/386 – pro procesor 386
** verze 2.0 přejmenována na Windows/286.
** 28. června 1988 verze 2.1 pro obě varianty Windows tedy 286 i 386.
** Verze pro procesor 386 uměla současně spouštět více aplikací pro DOS současně a také pracovat s více paměti.

==== Windows 3.0
** 22. května 1990
** Vlnu přechodu z prostředí MS-DOS na Windows
** Plná podpora instrukcí 80386
** Umí adresovat větší paměť pro jednotlivé aplikace,
** Podporovaly 16barevné prostředí
** Přepracovaný správce programů s ikonkami programů sdružovanými do skupin
** V roce 1991 byly tyto Windows aktualizovány o multimediální funkce.
** Objevují se i první grafické karty optimalizované pro Windows nabízející vyšší rozlišení a barevné hloubky.
** Roste počet aplikací
** Optimalizace hardware pro Windows

==== Windows 3.1
** Duben 1991
** Vylepšení verze 3.0.
** Lepší podpora multimedí.
** První verze DTP programů převedené z Mac OS – Adobe Photoshop a QuarkXpress.
** Instalaci tvořilo sedm 3,5palcových disket o kapacitě 1,4 MB, na disku instalace zabrala 4,5 MB.
** První Windows lokalizované do češtiny

==== Windows 95
** Srpen 1995, masivní reklamní kampaň.
** Nového uživatelské rozhraní
** Integrovaná podpora TCP/IP.
** Multitasking, plug-and-play, připojování k síti přes modem.
** V systému není internetový prohlížeč, pouze v rámci placeného Plus! Packu a samostatně zdarma se objevil na podzim roku 1995.
** Windows 95 OSR 2 (1996) – dostupná jen pro výrobce počítačů, podpora FAT32.
** DirectX – herní platforma

==== Windows 98
** Červen 1998
** Podpora DVD mechanik, USB zařízení (Windows 95 šly doplnit
** částečnou podporu), AGP a FireWire.
** Podporovány systémy s více monitory.
** Přímo v systému Internet Explorer 4.0.

==== Windows Me
** 2000 Windows Millennium Edition (Windows ME).
** Zamaskování MS-DOSu
** System Restore pro obnovu poškozených systémových souborů.
** Movie Maker a Media Player 7.
** Značná kritika uživatelů pro svou nespolehlivost.

==== Windows 2000
** Únoru 2000.
** Interní číslo verze je NT 5.0, ale Microsoft rozhodl, že opustí číslování verzemi a přešel na číslování verzí podle roku.
** Cílem verze 2000 bylo nahradit platformu NT a 9X ve firemním a domácím prostředí jediným společným základem.
** Podpora pro moderní hardware: Firewire, infraporty, USB, bezdrátové sítě, remote desktop, VPN.

==== Windows XP

==== Windows Vista
** Aero – nové grafické rozhraní – ale musí mít podporovaný hardware
** Vyhledávání pomocí indexování souborů
** Podpora XML
** Podpora Ipv6

==== Windows 7
** 64 i 32 bit pro osobní počítače
** 64 bit pro server
** Náročnější na HW
*** 64b chce
**** 2 GB RAM (max 192 GB)
**** 20 GB disk
*** 32b chce
**** 1 GB RAM (max 4 GB)
**** 16 GB disk
** Binární zavaděč

==== Windows8
** Nová verze Windows 8.1
** Optimalizováno pro mobilní a dotyková zařízení
** Dva módy:
*** Tablety
*** Klasická plocha

==== Windows 10

=== Souborové systémy ve Windows, přehled, vlastnosti
Řada systémů Windows NT používá souborové systémy FAT, NTFS, exFAT, Live File System a ReFS (poslední z nich je podporován až Windows Server 2012 R2, ale Windows z nich nemůže nabootovat). Windows používá u každého souborového systému pro označení jeho kořene další písmeno abecedy. Například cesta C:\Windows představuje adresář Windows na disku pojmenovaném C. Označení C: je nejčastěji používáno jako označení primárního oddílu, na kterém bývá operační systém nejčastěji nainstalován.

==== FAT
Poměrně starý systém - prvně použit u MS DOSu

* Nepoužívá žurnálování
* Používá se na paměťových kartách a flash discích.
* Používá se tabulka FAT (File Allocation Table) - informace kde je co uložené.
* Stromová struktura
* Maximálně 255 položek v kořenovém adresáři.
* FAT N (FAT 12, FAT 16, FAT 32) - umožňuje adresovat maximálně 2^N clusteru.
* Dříve 8+3 jméno souboru + přípona, dnes rozšíření VFAT.
* Ve Windows maximálně 32 GB oddíl.
* FAT32 naopak minimálně 512 MB.
* Maximální velikost souboru 4 GB.

==== NTFS
* Prvně u Windows NT.
* Neumožnuje používat male disky (diskety) - minimální velikost 4 GB
* Možnost nastavit práva
* Možnost indexovat soubory
* Názvy v Unicode
* Dynamické přemapování vadných sektoru.
* Šifrovaní a komprese.
* Pevné odkazy – funkční i po přesunu odkazovaného souboru.
* Řídké soubory – lepší uložení souboru, které mají velké části vyplněné 0

=== Prvky ochrany souborů a adresářů ve Windows
* Podobně jako v unixu se dají jednotlivým souborům nastavit oprávnění
* Windows nabízejí dvě možnosti šifrování, pomocí funkce Encrypted File System (EFS) nebo nástroje BitLocker Drive Encryption

== 4. Otázka
=== Správa paměti 

_Fragmentace je v informatice stav, kdy jsou data na datovém médiu uložena nesouvisle po částech._

=== Metoda správa jedné souvislé oblasti
* Technické vybavení
** mezní registr OS (ochrana paměti)
* Výhody:
** jednoduchost
** možnost pracovat i s malou pamětí
* Nevyhody:
** není využita celá paměť
** je-li uloha čekající, není využita paměť ani procesor
** ulohu nelze vykonat, požaduje-li větší paměť než je k dispozici

=== Metoda správa paměti pomocí sekcí
* Paměť se dělí na samostatné sekce, každá obsahuje paměťové sekce jedné úlohy
* Sledování stavu každé sekce - používá se, nepoužívá se, rozsah
** Plánovač úloh
** Přidělení paměti
** Uvolnění paměti
* Ochrana paměti (mezní registry)
* Metody
** Statické přidělování - přidělý vždy stejný blok
** Dynamické přidělování - dle potřeby úlohy
* Výhody
** multiprogramování
** není nutné speciální technické řešení 
** jednoduchá implementace
* Nevýhody
** fragmentace paměti
*** vnitřní
*** vnější
** časté změny stavových registrů
** není únosné, aby OS kontroloval registry při každém zápisu do paměti

Vnitřní fragmentace:

image::fragvnit.png[Vnitřní fragmentace]

Vnější fragmentace:

image::fragvnej.png[Vnější fragmentace]

== 5. Otázka
=== Správa paměti

_Fragmentace je v informatice stav, kdy jsou data na datovém médiu uložena nesouvisle po částech._

=== Metoda stránkování
* Adresový prostor každé úlohy se rozdělí na stejně velké sekce – stránky. Na stejně velké díly (bloky) se rozdělí operační paměť. Pak se mohou snadněji stránky přesouvat mezi bloky. 
* Bloky se stránkami jedné úlohy na sebe nemusí navazovat
* Každá stránka má registr (tabulky stránek)
* Moc velké stránky = fragmentace
* Moc malé stránky = moc registrů (náročné)
* Funkce modulů
** Sledování stavu - tabulka stránek pro každou úlohu
** Tabulka bloků - volný nebo užitý
** Plánovač úloh
** Přidělení a uvolňování bloků

Představa stránkování paměti:

image::strpampred.png[Představa stránkování paměti]

* Výhody:
** Odstranění fragmentace
** Větší počet úloh

* Nevýhody
** Náročné řešení
** Snížení rychlosti
** Tabulky zabírají paměť a snižují rychlost
** Vnitřní fragmentace - i nma malou úlohu velká stránka (stránky mají pevnou velikost)
** Omezeno fyzickým rozsahem paměti

=== Metoda stránkování na žádost

Virtuální paměť 

** Celá úloha se neumístí do operačního paměti
** Součet všech adresových prostor může překročit kapacitu paměti
* V paměti je pouze právě prováděná část úlohy
* Problém pokud program odkazuje na právě nezavedenou část úlohy
* Je nutná strategie rozhodování co má být v paměti zavedeno
* Tabulka stránek se rozšíří o stavový bit, určující zda je stránka zavedena
* Problém, není-li místo pro další stránku pak se musí nějaká odstranit (do záložní paměti). Může se stát, že tato je vzápětí požadována

Představa virtuální paměti:

image::strpredvirpam.png[Představa virtuální paměti]

Funkce modulu

* Sledování stavu paměti 
** Tabulky stránek (každá úloha)
** Bloků (jedna v systému)
** Tabulka souborů (pro každý adresový prostor úlohy) v záložní paměti 
* Rozhodování o přidělení paměti
* Přidělování paměti
* Uvolňování paměti

Algoritmy výměny

* FIFO (first in first out)
* LRU (least recently used)
* LFU (lease frequently used)
* NUR (not used recently) 
** Stránka má "used" bit, který pravidelně nuluje, pokud je třeba uvolnit z paměti vybere stránku, která má used bit 0

Výhody

* Odtranění fragmentace
* Není omezeno fyzickým rozsahem paměti
* Efektivní využití
* Multiprograming

Nevýhody

* Nákladnost
* Vnitřní fragmentace
* Nutnost ošetřit zahlcení systému
 
== 6. Otázka
=== Procesy
Proces je základní jednotka práce moderního OS se sdílením času.

* Současně běží více procesů
** Procesy OS
** Procesy aplikací
* OS střídavě obsluhuje procesy
* Program není proces, ale proces se vytvoří po spuštění programu

==== Struktura procesu
Proces obsahuje
* Ukazatel programu
* Zásobník 
** Dočasná data (parametry podprogramů, návratové adresy, dočasné proměné)
** Data pro globální proměné
* Obsah registrů procesoru

* Každý proces je reprezentován záznamem, který se jmenuje process control block (PCB), který obsahuje informace o procesu

* Struktura PCB
** Proces state
** Program counter (adresa následující insstrukce)
** Registry procesoru
** Informace plánování
** Memory management
** Accounting information (časový limit, číslo procesu)
** I/O status (seznam I/O přidělených pro tento proces, seznam otevřených souborů)

=== Životní cyklus procesu

Životní cyklus Pech:

image::procesStavDiagram.png[Proces stav diagram Pech]

Životní cyklus přednáška:

image::procesStavDiagramPred.png[Proces stav diagram přednáška]

Popis stavů
* Nový proces
* Probíhající (právě je vykonáván)
* Čekající (čeká na událost)
* Připravený (čeká na procesor)
* Ukončený

==== Vytvoření procesu
* Proces vznikne spuštěním aplikace
** Volání jádra fork
* Proces může vytvořit nový proces
** Parent proces
** Child proces
* Dvě možnosti existence parent a child procesu
** Parent běží současně s child procesem
** Parent čeká na ukončení child procesu
* Dvě možnosti vzhledem k adresovému prostoru
** Child je duplikátem parent procesu
** Child má vlastní program a ten je zaveden do paměti

==== Ukončení procesu
* Ke zrušení dochází po vykonání všech instrukcí
** Volání jádra exit
** Volání jádra abort vůči child procesu (parent končí a ukončuje potomky)
* Je-li ukončen parent process pak musí být ukončeni i všichni potomci (odhlášení uživatele nebo ukončení procesu na tvrdo)

==== Běh procesu
* Autonomní a kooperující procesy
* Možnosti spolupráce procesů
** Sdílení informací
** Urychlení výpočtu (vytvoření paralelního procesu)
** Modularita (pro každý modul zvláštní proces)
** Zvýšení pohodlí (uživatel spustí více procesů najednou)
* Procesy mohou běžet těmito způsoby
** Sekvenčně (další proces spuštěn po ukončení předchozího)
** Sekvenčně-paralelně (více procesů se dělí o čas procesoru, mutitasking)
** Paralelně (více procesů na více procesorech s podporou multitaskingu)

==== Přidělování procesoru
* Základní modul systému
** Plánovač procesu
** Dispatcher (provádí přepnutí kontextu)
* Plánovači
** Plánovači úloh
*** Vybírá úlohy ke spuštění
*** Spouští se s delší frekvencí (až minuty)
** Plánovači procesů
*** Vybírá se z připravených procesů 
*** Spouští se s velkou frekvencí (desetiny milisekundy)
** V některých OS není plánovač a všechny nové úlohy se rovnou zavádí

==== Metody vybírání procesů z fronty
* FIFO fronta
* Prioritní fronta
* SJF (Short job first)

==== Prioritní plánování
Každý proces má stanovenou prioritu
* Staticky
* Dynamicky

Priority v reálných OS
* Linux -20 nevyšší až 19 nejnižší (změna pomocí nice a renice)
* Windows 0 nejnižší až 31 nejvyšší (změna pomocí task manageru)

==== Přepnutí kontextu
* Střídání procesů = přepnutí kontextu
* Kontext procesu = informace o procesu
* Uložení a obnovení kontextu
* Kontext procesu
** Obsah adresových registrů
** Registr příznaků
** stav dalších zařízení, které proces používá

== 7. Otázka
=== Multitasking a jeho druhy
Multitasking je schopnost OS provádět několik procesů současně. Jádro rychle přepíná kontext (střídá procesy) takže uživatel má dojem, že běží současně.

==== Nepreemptivní multitasking
* Pseudomultitasking
** Na úrovni procesů si mohou navzájem předat procesor (rezidentní volání programů MS DOS)
** Omezené přepínání (O přepínání se stará jeden zvláštní program)
*** Možné poze u speciálně naprogramovaných aplikací (Mac OS před verzí 5 program Finder)
** Neomezené přepínání
*** Všechny programy (Mac OS do verze 6)
* Kooperativní multitasking
** Vylepšení neomezeného přepínání
** Pokud proces běží na popředí a čeká na I/O pak se procesor půjčí na krátkou dobu procesu na pozadí
** Uživatel si sám určí, který proces je na popředí přepnutím
** Procesy musí spolupracovat (předávat si procesor)
** Pokud je proces špatně naprogramován pak to neumí
** Windows před Win95
** Mac OS před Mac OS X
** iOS

==== Premptivní multitasking
* Pravidelné přepínání (každý proces smí být kdykolic přerušen)
* Sdílení času (k přepínání dochází k pravidelných časových intervalech nebo pokud dojde k přerušení/ukončení procesu)
* UNIX včetně Linux
* Windows NT a lepší
* Windows 95 a lepší
* Mac OS X

== 8. Otázka
=== Synchronizace procesů
* Mluvíme o procesech, ale v praxi probíhá synchronizace na úrovni vláken – slovo proces pak můžeme  nahradit slovem vlákno.
* Je nutné synchronizovat zejména paralelní procesy.
* Časově závislá chyba – vzniká podle pořadí přístupu procesu k proměnné.

=== Kritická sekce a její řešení
* Kritická sekce je taková část kódu, kterou nelze sdílet. Je třeba zajistit následující:
** Vzájemné vyloučení - do kritické sekce smí jen jeden proces
** Dostupnost kritické sekce - proces musí mít možnost se k ní v přiměřeném časovém kvantu dostat
** Proces je v kritické sekci konečnou dobu
* Řešené problémy:
** Uváznutí - deadlock
** Blokování - proces do kritické sekce nemůže i když je volná
** Stárnutí - příliš dlouhé čekání

==== Algoritmy pro přístup do kritické sekce
* Petersonův (zdvořilý) algoritmus
** Tento algoritmus lze použít pro dva procesy. Pokud první proces se chystá vstoupit do kritické sekce, pak označí zájem do ní vstoupit a dá přednost druhému procesu. Pak čeká až nastane jedna z dvou následujících možností:
*** Druhý proces odpoví, že nemá zájem do kritické sekce vstoupit a vrátí mu přednost
*** Druhý proces ukončil činnost v kritické sekci.
* Bakery (pekařův) algoritmus – FIFO
** Připomíná řešení pořadí na poště nebo úřadech. Před vstupem do kritické sekce získá proces lístek s číslem jeho pořadí. Pokud získají dva procesy stejné číslo, pak rozhoduje nižší PID. Kdo má aktuálně nejnižší číslo smí vstoupit do kritické sekce, jakmile se uvolní. Přidělovaná přístupová čísla se zvyšují o jedničku a po vyčerpání datového typu pokračují od jedné.
* Hardwarové řešení – funkce TestAndSet
** Procesory i386 a novější obsahují implementaci funkci TestAndSet. Jedná se o tzv. atomickou funkci – smí ji vždy vykonávat pouze jeden proces. Na platformě Intel se funkce nazývá Lock Bts. Pracuje se sdílenou Booleovskou proměnnou, která ukazuje, zda je volný vstup do kritické sekce. Při každém volání funkce, je vstup do kritické sekce nejprve uzamčen bez ohledu na návratovou
hodnotu. Pokud funkce vrátí hodnotu volno, nastaví se obsazeno, proces vstoupí do kritické sekce a
po skončení opět nastaví na volno. Vrátí-li se obsazeno, proces čeká ve smyčce. Tomu se říká
aktivní čekání. Toto čekání poměrně hodně zatěžuje procesor, proto není vhodné používat tuto
metodu, tam kde se očekává dlouhé čekání.
* Semafor – celočíselná proměnná, udávající přístupnost kritické sekce
** Je vlastně celočíselná proměnná P, pro kterou jsou definovány dvě atomické operace:
*** Lock (P) – snížení hodnoty semaforu P o 1
*** Unlock (P) – zvýšení hodnoty semaforu P o 1
** Pokud semafor P hlídá kritickou sekci, pak význam jeho hodnoty je následující:
*** kladná hodnota – počet procesů, které do sekce mohou vstoupit
*** nulová hodnota – sekce obsazena, ale žádný proces nečeká
*** záporná hodnota – sekce obsazena, absolutní hodnota proměnné udává aktuální počet procesů čekajících na vstup do kritické sekce
** Čekající procesy jsou pozastaveny. Je-li sekce volná, proces do ní vstoupí a zavolá funkci lock.
Není-li volná zavolá funkci lock a přesune se do fronty čekajících procesů. Při východu z kritické
sekce zavolá proces funkci unlock, a pokud čekají procesy ve frontě je první aktivován.
Samy funkce lock a unlock jsou atomické – musí se řešit jako kritické sekce, aby hodnota proměnné
P byla určena jednoznačně. Nelze zde použít semafory, proto se použije obvykle hardwarové
řešení, neboť v tomto případě je pobyt v kritické sekci krátký (změna proměnné) a tak smyčky
netrvají dlouho. Binární semafor je takový semafor, který má jen dva stavy – stůj a volno.
* Monitor – outsourcing
Je abstraktní datový typ obsahující sdílená data, operace s nimi prováděné a podmínky. Požadavky
se řadí do fronty a monitor je postupně řeší, čímž je zajištěno vzájemné vyloučení.
Můžeme si jej představit jako outsourcování požadavků procesů na přístup do kritické sekce do
monitoru. Tím, že monitor má kompletní přehled o stavu kritické sekce a počtu procesů, které se
nacházejí jak uvnitř sekce, tak do ní chtějí vstoupit, může zajistit její bezproblémovou obsluhu.

Monitor:

image::monitor.png[Monitor]

== 9. Otázka
=== Synchronizační problémy
==== Producent a konzument – pásová výroba
Obvykle se řeší pro dva procesy, ale lze jej zobecnit i pro více. Jeden z nich pouze generuje data
(producent) a druhý je naopak pouze zpracovává (konzument). Data si vzájemně posílají přes
vyrovnávací paměť o N položkách.
Je-li paměť plná musí čekat producent, naopak pokud je paměť prázdná musí čekat konzument.
Tento problém se obvykle řeší pomocí semaforů. Tento problém si můžeme představit v praxi jako
pásovou výrobu.

==== Model a obraz – letadlo
Jedná se o podobný problém jako v předchozí situaci. V tomto případě nás zajímá vždy aktuální
stav některé proměnné. Můžeme si jej představit jako procesy obsluhující letadlo za letu. Jedny
procesy zjišťují aktuální údaje (výška, rychlost, spotřeba paliva…), jiné je zobrazují.
Je nutné mít vždy co nejpřesnější údaje, na druhou stranu je zase nesmíme zjišťovat extrémně často,
neboť by pak mohly ukazatele poblikávat a být nečitelné. Procesy produkující informace nám
mohou nastavit proměnnou (např. Binární semafor), která ukazuje, že došlo ke změně a proces,
který si informace načte, jí opět vynuluje.

==== Čtenáři a písaři – internetové noviny
Jedná se o problém přístupu ke sdíleným datům. Některé procesy data pouze modifikují (písaři),
jiné je pouze čtou (čtenáři). Libovolný počet čtenářů smí k datům přistoupit současně, ale pokud
přistoupí písař, nesmí přistoupit ani čtenář ani jiný písař.
Řeší se pomocí binárních semaforů. Dokud k datům přistupují čtenáři nesmí přistoupit písař, takže
zde hrozí zastarání dat.

==== Hladoví filozofové 
Okolo stolu sedí filozofové. Před každým je miska rýže a jedna hůlka. Filozofové přemýšlejí
o stejné věci a všichni najednou dostanou hlad. Každý vezme jednu hůlku, čímž vznikne situace,
kdy každý filozof drží jednu hůlku (kterou se nenají), další hůlku nemůže dostat, ale odmítá se
vzdát své. Takové situaci říkáme deadlock.

Filosofové:

image::filosofove.png[Filosovofé]

==== Deadlock
Otázka 10

== 10. Otázka
=== Deadlock a jeho řešení
V multiprogramovém prostředí si mohou různé prostředky konkurovat v získání
konečného počtu zdrojů. Proces požaduje zdroje, a jestliže tyto zdroje nejsou v danou chvíli
dostupné, je proces přesunut do stavu čekající. Může se stát, že čekající proces svůj stav již nikdy
nezmění, protože zdroje, na které čeká, drží jiné čekající procesy. Tato situace je nazývána deadlock

Klasickým příkladem je problém hladových filozofů. Jiný typický případ z prostředí výpočetní techniky, je situace, kdy dva procesy drží každý po jednom souboru otevřeném pro zápis a potřebují zapsat do souboru, který má otevřený konkurenční proces. Samy však nejsou ochotné uvolnit svůj soubor dříve, než zapíšou do konkurenčního. Ještě jiný příklad deadlocku, opět z dopravy: křižovatka dvou cest nerozlišená dopravními značkami, kde přijede současně po každé cestě automobil, který chce jet rovně.

Dopravní deadlock:

image::dopdeadlock.png[Dopravní deadlock]

==== Přidělování zdrojů procesům
Systém obsahuje konečný počet zdrojů, například paměť, procesor (procesory, jádra), vstupně
výstupní zařízení. Některá jsou nesdílitelná (nemohou je využívat dva procesy současně), například tiskárna, soubor pro zápis apod. Proces musí o zdroj požádat před jeho užitím a po jeho použití jej musí opět uvolnit. Proces současně nesmí požadovat více zdrojů, než jsou možnosti systému.
Deadlock je čekání na událost, která nemůže nastat.

==== Podmínky pro vznik deadlocku
* Vzájemná jedinečnost – v systému existuje nesdílitelný zdroj – může jej v daném okamžiku mít jen jeden proces
* Drží a čeká – existuje proces, který drží nesdílitelný zdroj a čeká na přidělení jiného nesdílitelného zdroje
* Nepreemptivnost – zdroj může být uvolněn pouze po ukončení úlohy
* Kruhové čekání – procesy čekající vzájemně na zdroje
Tyto čtyři podmínky musí nastat současně

==== Metody řešení deadlocku
Existují čtyři metody řešení deadlocku:

* Prevence deadlocku
** Řeší se zrušením některé podmínky deadlocku
** Nepoužívat zámky u prostředků umožňujících sdílený přístup
** Proces může žádat o další prostředky až tehdy když všechny své uvolnil
** Pokud proces požádá o nedostupný prostředek je pozastaven, jsou mu všechny prostředky odebrány a čeká se, až může všechny prostředky obdržet
** Prostředky mají stanovené pořadí a lze je získat pouze v tomto pořadí
* Vyhýbání se deadlocku
* Každý proces před začátkem oznámí kolik bude potřebovat prostředků. Nelze jej spustit, pokud existuje možnost, že mu prostředky nebudou moci být zajištěny.
* Užívá se tzv. bankéřův algoritmus – bankéř nemůže půjčit prostředky, pokud nemůže zajistit požadavek na výběr nejvyššího vkladu.
* Tuto metodu používají obvykle real time operační systémy.
* Řešení deadlocku
** Vychází z předpokladu, že je deadlock nepravděpodobný. Systém se snaží cyklicky detekovat deadlock a řešit ho. Možné způsoby jsou:
*** Ukončení procesu (restart procesu)
*** Přidání zdroje – obvykle nemožné
*** Odebrání zdroje nějakému procesu
* Ponechání řešení na lidské obsluze
** Typickým příznakem deadlocku je zaplněná paměť a současně málo zatížený procesor. Nejlepší způsob řešení v takovém případě je postupné ukončování procesů a sledování, zda se systém rozběhne.
** Nejjednodušší řešení je samozřejmě restart systému a opětovné spuštění aplikací. Může však dojít ke ztrátě dat a je pravděpodobné, že při spuštění stejných aplikací může opět nastat deadlock.
** Jedná se vlastně o předchozí metodu, ale namísto operačního systému je do role supervizora
dosazen uživatel.

== 11. Otázka
=== Struktura odkládacího zařízení, soubor, adresář, plánování disku.
Odkládací zařízení (jinak zvané paměťové médium nebo úložiště) je periferní zařízení, na které se ukládají data.
Jedná se o velmi důležitou část - i samotný operační systém je na paměťovém médiu
Média dělíme na:

* Pevná - harddisk, SSD
* Výměnná - CD, DVD, flash disk

==== Adresářová struktura
* Soubor
** Data se nalézají v souborech. Soubor můžeme pokládat za základní jednotku ukládání dat.
* Adresář (Složka)
** Soubory se slučuji do adresářů. Adresáře tvoří strukturu, obvykle obsahuji další adresáře a soubory. ** Adresář,který obsahuje vše co se na disku nachází se nazývá kořenový (root).
* Dělení adresářových struktur
** Jednoúrovňová - existuje pouze adresář root a vše je v něm (CP/M)
** Dvouúrovňová - v rootu jsou adresáře, ale ty už nemohou obsahovat další adresáře jen soubory (RSX)
** Stromová - v každém adresáři mohou byt další soubory i adresáře. Připomíná to strom s kořenem (root). (FAT)
** Acyklická - soubory a adresáře mohou být ve více adresářích - nesmí tam být ale cykly (dva adresáře se nemohou odkazovat vzájemně na sebe). Snadný přístup k témuž souboru z více adresářů (linky).(NTFS, Extended)
** Cyklická - může obsahovat cykly

==== Soubor
Nad souborem jsou definovány následující operace, které zajišťuje operační systém:

* Vytvoření
* Čtení
* Zápis
* Změna pozice v souboru (vyhledání místa)
* Smazání

Rozlišujeme různé druhy souborů:

* Standardní - dokumenty, programy.
* Adresáře - z pohledu většiny operačních systému je adresář zvláštním typem souboru.
* Simulované - přístup k I/O zařízením.
* Odkládací soubory -virtuální paměť.

Fragmentace souborů: 

* vnější – soubory jsou rozdělené po celém paměťovém médiu
* vnitřní – velký počet malých souborů – volná místa v clusterech

Soubory dále dělíme dle přístupu na médiu:

* Přímý (CD, disk) – kterýkoliv soubor (nebo místo v souboru) je kdykoliv k dispozici
* Sekvenční (magnetická páska) – Pokud chceme konkrétní místo musí se projet vše od začátku (nebo aktuálního místa) až po místo požadované. Jako magnetofonová páska.
* Indexový (magnetická páska s přeskakováním) – Lze adresovat některá místa. Jako magnetofonová páska, která umí najít začátky písní

==== Plánování disku
Je činnost, která nám říká, jakým způsobem se budou vyřizovat požadavky na čtení a zápis u disku. Je třeba zvolit vhodný způsob, abychom zbytečně nečekali a na druhou stranu disk nezatěžovali zbytečnými posuny hlavy.

* Plánování FCFS (First-Come First-Served) – požadavky jsou vyřizovány v pořadí v jakém došly. Výhoda – poměrně rychlý systém, nevýhoda – velké přesuny hlavy a z toho plynoucí značné namáhání pohyblivých částí.
* Plánování SSTF (Shortest-Seek-Time-First) – nejprve vyřízen ten požadavek který vyvolá nejmenší posun hlavy. Nevýhody – Hlava se může pohybovat tam a zpět. Požadavky na vzdálenější stopy mohou teoreticky čekat nekonečně dlouho.
* SCAN plánování – hlava projíždí disk tam a zpět z jednoho konce na druhý a cestou vyřizuje
požadavky. Elevator algoritmus (podobá se výtahu).
* C-SCAN – hlava se po dojetí na konec vrátí na začátek jako by začátek navazoval na konec. Ještě je možné vylepšit tak, že pokud mezi hlavou a krajem disku není žádný požadavek, hlava se začne vracet zpět.


== 12. Otázka
=== Souborové systémy
Vlastnosti souborových systémů:

* Souborové systémy s okamžitým zápisem – v daném okamžiku pouze jedna operace a další musí čekat. Data se nemohou ztratit, ale je to pomalejší (FAT)
* Opatrný zápis – bezpečná posloupnost operací, jako u databází.
* Opožděný zápis – cache paměť. Rychlé, ale při havárii se data, která jsou dosud v cache, ale nejsou ještě zapsána, mohou ztratit.
* Žurnálovací souborové systémy – uchovávají se informace o provedených operacích. Při
výpadku je možné data obnovit (NTFS, většina Linuxových FS)

=== FAT
* První široce rozšířený file systém
* Dnes se používá na paměťových kartách a flash pamětích
* Velmi rychlí
* Nepoužívá žurnálování
* Používá se tabulka FAT (File Allocation Table) - informace kde je co uložené.
* Stromová struktura
* Maximálně 255 položek v kořenovém adresáři.
* FAT N (FAT 12, FAT 16, FAT 32) - umožňuje adresovat maximálně 2^N clusteru.
* Dříve 8+3 jméno souboru + přípona, dnes rozšíření VFAT.
* Ve Windows maximálně 32 GB oddíl.
* FAT32 naopak minimálně 512 MB.
* Maximální velikost souboru 4 GB.

=== NTFS
Žurnálovací souborový systém vyvinutý Microsoftem. Podobně jako v UNIXu je vše soubor. Lze indexovat dle typu souboru, což umožňuje rychlejší vyhledávání. Lze nastavovat práva pro uživatele nebo pro skupinu uživatelů.

* Prvně u Windows NT.
* Neumožnuje používat male disky (diskety) - minimální
* velikost 4 GB
* Možnost nastavit práva
* Možnost indexovat soubory
* Názvy v Unicode
* Dynamické přemapování vadných sektoru.
* Šifrovaní a komprese.
* Pevné odkazy – funkční i po přesunu odkazovaného souboru.
* Řídké soubory – lepší uložení souboru, které mají velké části vyplněné 0

Srovnání FAT a NTFS:

image::fatxntfs.png[Srovnání FAT a NTFS]

=== UNIXové souborové systémy
==== XFS
Žurnálovací souborový systém, který je 64 bitový, a proto je velikost souboru i souborového
systému z našeho pohledu téměř neomezená. Je možné rezervovat přístupové pásmo pro přístup
k souborům, to je výhoda u multimédií.
Jsou žurnálována metadata ale ne samotná data – rychlejší ale méně bezpečný než ext3.

==== ZFS
Zettabyte File System. 128 bitový souborový systém vyvinutý původně firmou Sun pro operační
systém Solaris, nyní je používán i v BSD a připravují se ovladače pro Linux. Má v sobě přímo
integrován manažér logických oddílů. Může uchovávat až 1 ZB dat (1 ZB = 1 bilión TB). Umí
automaticky opravovat chyby.

==== BTRFS 
Souborový systém podobny ZFS, založený na B stromech.

==== APFS
Apple File System (Starší HFS+) – pro MacOS


==== Extended (Ext)
* Unixové systémy
* Verze Ext (již se nepoužívá), Ext2, Ext3 a Ext4
* Bloky mají velikost 512, 1024, 2048 nebo 4096 B.
* První blok je boot blok.
* Další bloky jsou rozděleny do skupin, každá obsahuje superblok s informacemi o celém disku - při poškození jednoho se použije jiny.
* Informace o souborech jsou v tzv. i-node (i-uzel).
* Volné místo se eviduje v řetězovém seznamu.
* Moznost použít odkazy (linky)
* Lze použít odkazy (links), které mohou být následujícího typu:
** Pevný odkaz (hard link) více odkazů na stejný soubor, žádný není hlavní. Soubor smí být smazán, když na něj již nevede žádný takovýto odkaz. Nesmí vzniknout cykly. Nesmí odkazovat na sebe sama a nesmí vést na jiný disk
** Symbolické odkazy (soft link) – odkazují na umístění souborů, odpadají omezení u pevných odkazů
* Název souboru může mít až 255 znaků. 
* Od verze ext3 se jedná o žurnálovací systém. 
* Systém ext2 je naproti tomu významně rychlejší a používá se tam, kde záleží na rychlosti a data se často nemění (disk ze kterého se zavádí systém).

Tabulka vlastností verzí:

image::ext.png[Tabulka vlastností verzí]

